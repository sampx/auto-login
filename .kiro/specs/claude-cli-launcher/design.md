# è®¾è®¡æ–‡æ¡£

## æ¦‚è¿°

è®¾è®¡ä¸€ä¸ªåä¸º `mycld` çš„ shell è„šæœ¬ï¼Œä½œä¸º claude cli çš„å¯åŠ¨å™¨ã€‚è¯¥è„šæœ¬å°†æ ¹æ®ä¸åŒçš„å‘½ä»¤è¡Œå‚æ•°åŠ è½½ç›¸åº”çš„ç¯å¢ƒé…ç½®æ–‡ä»¶ï¼ŒéªŒè¯å¿…è¦çš„ç¯å¢ƒå˜é‡ï¼Œç„¶åå¯åŠ¨ claude cliã€‚è„šæœ¬æ”¯æŒä¸¤ç§ä¸»è¦æ¨¡å¼ï¼šç›´æ¥æ¨¡å¼ï¼ˆæ— å‚æ•°ï¼‰å’Œé…ç½®æ¨¡å¼ï¼ˆå¸¦å‚æ•°ï¼‰ã€‚

## é¡¹ç›®ç»“æ„

è„šæœ¬å°†æ”¾ç½®åœ¨é¡¹ç›®çš„ `tools` ç›®å½•ä¸‹ï¼š

```
é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ tools/
â”‚   â””â”€â”€ mycld           # Claude CLI å¯åŠ¨è„šæœ¬
â”œâ”€â”€ å…¶ä»–é¡¹ç›®æ–‡ä»¶...
```

éœ€è¦å…ˆåˆ›å»º `tools` ç›®å½•æ¥å­˜æ”¾è¯¥è„šæœ¬ã€‚è„šæœ¬åˆ›å»ºåéœ€è¦è®¾ç½®æ‰§è¡Œæƒé™ï¼š`chmod +x tools/mycld`

## æ¶æ„

### æ•´ä½“æ¶æ„

```
ç”¨æˆ·è¾“å…¥ â†’ å‚æ•°è§£æ â†’ ç¯å¢ƒéªŒè¯ â†’ é…ç½®åŠ è½½ â†’ Claude CLI å¯åŠ¨
```

### æ ¸å¿ƒç»„ä»¶

1. **å‚æ•°è§£æå™¨** - è§£æå‘½ä»¤è¡Œå‚æ•°å¹¶ç¡®å®šè¿è¡Œæ¨¡å¼
2. **ç¯å¢ƒéªŒè¯å™¨** - æ£€æŸ¥ä¾èµ–å’Œç¯å¢ƒå˜é‡
3. **é…ç½®åŠ è½½å™¨** - æ ¹æ®å‚æ•°åŠ è½½ç›¸åº”çš„é…ç½®æ–‡ä»¶
4. **CLI å¯åŠ¨å™¨** - å¯åŠ¨ claude å‘½ä»¤å¹¶ä¼ é€’å‚æ•°

## ç»„ä»¶å’Œæ¥å£

### 1. å‚æ•°è§£æå™¨ (parse_arguments)

**èŒè´£ï¼š** è§£æå‘½ä»¤è¡Œå‚æ•°å¹¶ç¡®å®šè„šæœ¬è¿è¡Œæ¨¡å¼

**è¾“å…¥ï¼š** å‘½ä»¤è¡Œå‚æ•°æ•°ç»„ `$@`

**è¾“å‡ºï¼š** è®¾ç½®å…¨å±€å˜é‡
- `MODE`: è¿è¡Œæ¨¡å¼ (direct/k2/anyrouter)
- `VERBOSE`: æ˜¯å¦å¯ç”¨è¯¦ç»†è¾“å‡º
- `CLAUDE_ARGS`: ä¼ é€’ç»™ claude çš„å‚æ•°

**æ¥å£ï¼š**
```bash
parse_arguments() {
    # è§£æ --help, -h, --verbose, -v, --k2, --anyrouter
    # è®¾ç½®ç›¸åº”çš„å…¨å±€å˜é‡
    # å¤„ç†æ— æ•ˆå‚æ•°çš„é”™è¯¯æƒ…å†µ
}
```

### 2. ç¯å¢ƒéªŒè¯å™¨ (validate_environment)

**èŒè´£ï¼š** éªŒè¯ claude cli å®‰è£…å’Œå¿…è¦çš„ç¯å¢ƒå˜é‡

**è¾“å…¥ï¼š** å½“å‰è¿è¡Œæ¨¡å¼

**è¾“å‡ºï¼š** éªŒè¯ç»“æœï¼ˆæˆåŠŸ/å¤±è´¥ï¼‰

**æ¥å£ï¼š**
```bash
validate_environment() {
    local mode=$1
    # æ£€æŸ¥ claude å‘½ä»¤æ˜¯å¦å­˜åœ¨
    # æ ¹æ®æ¨¡å¼éªŒè¯ç¯å¢ƒå˜é‡
    # è¿”å›éªŒè¯ç»“æœ
}
```

### 3. é…ç½®åŠ è½½å™¨ (load_configuration)

**èŒè´£ï¼š** æ ¹æ®è¿è¡Œæ¨¡å¼åŠ è½½ç›¸åº”çš„é…ç½®æ–‡ä»¶

**è¾“å…¥ï¼š** è¿è¡Œæ¨¡å¼

**è¾“å‡ºï¼š** åŠ è½½é…ç½®æ–‡ä»¶å¹¶è®¾ç½®ç¯å¢ƒå˜é‡

**æ¥å£ï¼š**
```bash
load_configuration() {
    local mode=$1
    # æ ¹æ®æ¨¡å¼ source ç›¸åº”çš„ .zrc æ–‡ä»¶
    # å¤„ç†æ–‡ä»¶ä¸å­˜åœ¨çš„æƒ…å†µ
}
```

### 4. CLI å¯åŠ¨å™¨ (launch_claude)

**èŒè´£ï¼š** å¯åŠ¨ claude cli å¹¶ä¼ é€’å‚æ•°

**è¾“å…¥ï¼š** claude å‚æ•°æ•°ç»„

**è¾“å‡ºï¼š** å¯åŠ¨ claude è¿›ç¨‹

**æ¥å£ï¼š**
```bash
launch_claude() {
    # ä½¿ç”¨ exec å¯åŠ¨ claude å‘½ä»¤
    # ä¼ é€’æ‰€æœ‰å‚æ•°
}
```

## æ•°æ®æ¨¡å‹

### è¿è¡Œæ¨¡å¼æšä¸¾
```bash
# è¿è¡Œæ¨¡å¼
MODE_DIRECT="direct"      # ç›´æ¥æ¨¡å¼ï¼Œä¸åŠ è½½é…ç½®
MODE_K2="k2"             # K2 é…ç½®æ¨¡å¼
MODE_ANYROUTER="anyrouter" # AnyRouter é…ç½®æ¨¡å¼
```

### é…ç½®æ–‡ä»¶è·¯å¾„
```bash
# é…ç½®æ–‡ä»¶è·¯å¾„
CONFIG_DIR="$HOME/tools/mac_zsh"
K2_CONFIG="$CONFIG_DIR/k2.zrc"
ANYROUTER_CONFIG="$CONFIG_DIR/anyrouter.zrc"
```

### ç¯å¢ƒå˜é‡éªŒè¯è§„åˆ™
```bash
# å¿…éœ€çš„ç¯å¢ƒå˜é‡ï¼ˆä»…åœ¨é…ç½®æ¨¡å¼ä¸‹ï¼‰
REQUIRED_VARS=("ANTHROPIC_BASE_URL" "ANTHROPIC_AUTH_TOKEN")
```

## é”™è¯¯å¤„ç†

### é”™è¯¯ç±»å‹å’Œå¤„ç†ç­–ç•¥

1. **å‘½ä»¤è¡Œå‚æ•°é”™è¯¯**
   - æ— æ•ˆå‚æ•°ï¼šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯å’Œå¸®åŠ©æ–‡æœ¬ï¼Œé€€å‡ºç  1
   - å†²çªå‚æ•°ï¼šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼Œé€€å‡ºç  1

2. **ä¾èµ–æ£€æŸ¥é”™è¯¯**
   - claude cli æœªå®‰è£…ï¼šæ˜¾ç¤ºå®‰è£…æç¤ºï¼Œé€€å‡ºç  2
   - é…ç½®æ–‡ä»¶ä¸å­˜åœ¨ï¼šæ˜¾ç¤ºæ–‡ä»¶è·¯å¾„å’Œåˆ›å»ºæç¤ºï¼Œé€€å‡ºç  3

3. **ç¯å¢ƒå˜é‡é”™è¯¯**
   - å¿…éœ€å˜é‡ç¼ºå¤±ï¼šæ˜¾ç¤ºç¼ºå¤±çš„å˜é‡åï¼Œé€€å‡ºç  4
   - ç›´æ¥æ¨¡å¼ä¸‹å­˜åœ¨é…ç½®å˜é‡ï¼šæ˜¾ç¤ºè­¦å‘Šä¿¡æ¯ï¼Œé€€å‡ºç  5

4. **é…ç½®åŠ è½½é”™è¯¯**
   - é…ç½®æ–‡ä»¶è¯­æ³•é”™è¯¯ï¼šæ˜¾ç¤ºæ–‡ä»¶è·¯å¾„å’Œé”™è¯¯ä¿¡æ¯ï¼Œé€€å‡ºç  6

### é”™è¯¯ä¿¡æ¯æ ¼å¼
```bash
# é”™è¯¯ä¿¡æ¯æ ¼å¼
error_message() {
    echo "âŒ é”™è¯¯: $1" >&2
    echo "ğŸ’¡ å»ºè®®: $2" >&2
}
```

## æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•åœºæ™¯

1. **å‚æ•°è§£ææµ‹è¯•**
   - æµ‹è¯•æ‰€æœ‰æœ‰æ•ˆå‚æ•°ç»„åˆ
   - æµ‹è¯•æ— æ•ˆå‚æ•°å¤„ç†
   - æµ‹è¯•å¸®åŠ©ä¿¡æ¯æ˜¾ç¤º

2. **ç¯å¢ƒéªŒè¯æµ‹è¯•**
   - æµ‹è¯• claude cli å­˜åœ¨/ä¸å­˜åœ¨æƒ…å†µ
   - æµ‹è¯•ç¯å¢ƒå˜é‡å­˜åœ¨/ç¼ºå¤±æƒ…å†µ
   - æµ‹è¯•ä¸åŒæ¨¡å¼ä¸‹çš„éªŒè¯é€»è¾‘

3. **é…ç½®åŠ è½½æµ‹è¯•**
   - æµ‹è¯•é…ç½®æ–‡ä»¶å­˜åœ¨/ä¸å­˜åœ¨æƒ…å†µ
   - æµ‹è¯•é…ç½®æ–‡ä»¶åŠ è½½åçš„ç¯å¢ƒå˜é‡è®¾ç½®
   - æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³•é”™è¯¯å¤„ç†

4. **é›†æˆæµ‹è¯•**
   - æµ‹è¯•å®Œæ•´çš„å¯åŠ¨æµç¨‹
   - æµ‹è¯•å‚æ•°ä¼ é€’ç»™ claude cli
   - æµ‹è¯•è¯¦ç»†è¾“å‡ºæ¨¡å¼

### æµ‹è¯•æ•°æ®å‡†å¤‡
```bash
# åˆ›å»ºæµ‹è¯•ç”¨çš„é…ç½®æ–‡ä»¶
setup_test_configs() {
    mkdir -p "$TEST_CONFIG_DIR"
    echo 'export ANTHROPIC_BASE_URL="https://api.k2.com"' > "$TEST_CONFIG_DIR/k2.zrc"
    echo 'export ANTHROPIC_AUTH_TOKEN="test-token-k2"' >> "$TEST_CONFIG_DIR/k2.zrc"
}
```

## å®ç°ç»†èŠ‚

### è„šæœ¬ç»“æ„
```bash
#!/bin/bash

# å…¨å±€å˜é‡å®šä¹‰
# å·¥å…·å‡½æ•°å®šä¹‰
# æ ¸å¿ƒåŠŸèƒ½å‡½æ•°å®šä¹‰
# ä¸»å‡½æ•°
# è„šæœ¬å…¥å£ç‚¹
```

### è¯¦ç»†è¾“å‡ºå®ç°
```bash
verbose_log() {
    if [[ "$VERBOSE" == "true" ]]; then
        echo "ğŸ” [DEBUG] $1" >&2
    fi
}

info_log() {
    echo "â„¹ï¸  $1" >&2
}
```

### å¸®åŠ©ä¿¡æ¯è®¾è®¡
```bash
show_help() {
    cat << EOF
mycld - Claude CLI å¯åŠ¨å™¨

ç”¨æ³•:
    mycld [é€‰é¡¹] [claudeå‚æ•°...]

é€‰é¡¹:
    --k2            ä½¿ç”¨ K2 é…ç½®å¯åŠ¨
    --anyrouter     ä½¿ç”¨ AnyRouter é…ç½®å¯åŠ¨
    -v, --verbose   æ˜¾ç¤ºè¯¦ç»†è¾“å‡º
    -h, --help      æ˜¾ç¤ºæ­¤å¸®åŠ©ä¿¡æ¯

ç¤ºä¾‹:
    mycld                           # ç›´æ¥å¯åŠ¨ claude
    mycld --k2 chat                 # ä½¿ç”¨ K2 é…ç½®å¯åŠ¨ claude chat
    mycld --anyrouter --verbose     # ä½¿ç”¨ AnyRouter é…ç½®å¹¶æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
EOF
}
```

### å®‰å…¨è€ƒè™‘

1. **è·¯å¾„å®‰å…¨**
   - ä½¿ç”¨ç»å¯¹è·¯å¾„å¼•ç”¨é…ç½®æ–‡ä»¶
   - éªŒè¯é…ç½®æ–‡ä»¶å­˜åœ¨æ€§å’Œå¯è¯»æ€§

2. **ç¯å¢ƒå˜é‡å®‰å…¨**
   - ä¸åœ¨æ—¥å¿—ä¸­æ˜¾ç¤ºæ•æ„Ÿçš„ç¯å¢ƒå˜é‡å€¼
   - éªŒè¯ç¯å¢ƒå˜é‡æ ¼å¼çš„åˆæ³•æ€§

3. **å‚æ•°ä¼ é€’å®‰å…¨**
   - æ­£ç¡®å¤„ç†åŒ…å«ç©ºæ ¼çš„å‚æ•°
   - é˜²æ­¢å‘½ä»¤æ³¨å…¥æ”»å‡»

### æ€§èƒ½ä¼˜åŒ–

1. **å¿«é€Ÿå¯åŠ¨**
   - æœ€å°åŒ–ç¯å¢ƒæ£€æŸ¥æ—¶é—´
   - å»¶è¿ŸåŠ è½½éå¿…éœ€çš„é…ç½®

2. **å†…å­˜ä½¿ç”¨**
   - é¿å…ä¸å¿…è¦çš„å˜é‡å­˜å‚¨
   - åŠæ—¶æ¸…ç†ä¸´æ—¶å˜é‡